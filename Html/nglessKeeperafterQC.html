<!DOCTYPE html>
<html lang="en">

<!-- Load angular JS from google -->
<script src="htmllibs/angular.min.js"></script>
<!-- Load angular JS from google -->
<script src="htmllibs/angular-sanitize.js"></script>
<!-- Bootstrap core CSS -->
<link href="htmllibs/bootstrap.min.css" rel="stylesheet">    
<!-- Custom styles for this template -->
<link href="nglessKeeper.css" rel="stylesheet">

<link href="htmllibs/bootstrap-glyphicons.css" rel="stylesheet">   


<title>Ngless</title>

<body data-spy="scroll" data-target=".navbar-example">

  <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" >NGLess</a>
      </div>
      <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
          <li><a href="nglessKeeper.html">Home</a></li>
          <li><a href="nglessScriptCreator.html">Create Script</a></li>
          <li><a href="nglessKeeperbeforeQC.html">Before QC</a></li>
          <li class="active"><a href="nglessKeeperafterQC.html">After QC</a></li>
          <li><a href="nglessKeepervisualize.html">Visualize</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>


  <div class="bs-docs-header" id="content">
      <div class="container">
        <h1>After Quality Control</h1>
        <p>Browse through out all your NGLess results</p>
      </div>
  </div>

<div  ng-app="myApp" ng-controller="FilesProcessedCtrl" class="container">
 
  <div class="container">
    <div class="row">
      <div id="nav-wrapper" class="col-md-3">
       <div id="nav" class="navbar-example">
          <ul id="leftlist" class="nav nav-pills nav-stacked sidenav">
             <li ng-repeat="f in filesprocessed" ng-class="{active: $index == 0}">
                <a href="#file{{$index}}"> 
                 <span style="float:right" class="glyphicon glyphicon-chevron-right"></span>
                  File {{getFileName(f.name)}}
                </a>
            </li>
          </ul>
        </div>
      </div>

      <div class="col-md-9">
        <div ng-repeat="f in filesprocessed">
          <section id="file{{$index}}">
            <div class="page-header"> <h2>Statistics of {{getFileName(f.name)}}</h2></div>
             <p > Here can be seen the resultant statistics of the applied NGLess script to the dataset <strong>{{getFileName(f.name)}}</strong>. </p>
             <p class="titletext"> The file was processed at {{f.time}}. </p>
             <iframe class="frameFastQ" frameborder="0" ng-src="{{trustSrc(f.name + '$afterQC/index.html')}}"></iframe>
           </section>
          </div>
        </div>
      </div>
    </div> <!-- /.container -->
  </div>
    <div id="footer">
      <div class="container">
        <p>Happily designed by <a href="https://github.com/luispedro">Luis Pedro Coelho</a> and <a href="https://github.com/montoias">Paulo Monteiro</a>. <a href="https://github.com/luispedro/ngless"><img align="right" style="float:right; width:36px" src="htmllibs/Octocat.png"> </img> </a></p>
      </div>
    </div>


  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="htmllibs/jquery-latest.min.js"></script>
  <script src="htmllibs/bootstrap.min.js"></script>
  <script src="filesProcessed.js"></script>

  <script>

    $(function() {

        $('#nav-wrapper').height($("#nav").height());
        
        $('#nav').affix({
            offset: { top: $('#nav').offset().top - 80}
        });
    });
    $("ul").on('click', 'li', function(e) {
      $("li.active").removeClass( "active" );
      $(this).addClass("active");
    });
    var app = angular.module('myApp', ['ngSanitize']);

    app.factory('FilesProcessed', function() {
      return filesProcessed;
    });

    function FilesProcessedCtrl($scope, $sce, FilesProcessed){
      $scope.filesprocessed = validateFiles(FilesProcessed);

      function validateFiles (files) {
        return files.filter(function(obj) {
          return urlExists("serveF?id=" + obj.name.split("/").reverse()[0] + '$afterQC/index.html')
        });
      }
      
      function urlExists(url)
      {
        var http = new XMLHttpRequest();
        http.open('HEAD', url, false);
        http.send();
        return http.status != 404;
      }

      $scope.getFileName = function(path){
         var pos = path.split("/").length;
             fileName = path.split("/")[pos - 1];
         return fileName.split('.')[0];    
      }
      $scope.trustSrc = function(src) {
        var p = src.split("/");
        var path = p.splice(p.length - 2, p.length).join("/");

        return $sce.trustAsResourceUrl(path);
      }
    }

  </script>

</body>
</html>